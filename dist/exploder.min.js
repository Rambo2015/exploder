!function(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):"object"==typeof exports?exports.Exploder=factory():root.Exploder=factory()}(this,function(){return function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)}([function(module,exports,__webpack_require__){"use strict";module.exports=__webpack_require__(1)},function(module,exports,__webpack_require__){"use strict";var _interopRequire=function(obj){return obj&&(obj["default"]||obj)},Gif=_interopRequire(__webpack_require__(2)),StreamReader=_interopRequire(__webpack_require__(3)),Promises=__webpack_require__(4).Promises,url=URL&&URL.createObjectURL?URL:webkitURL,gifCache=new Map,Exploder=function(file){this.file=file};Exploder.prototype.load=function(){var _this=this,cachedGifPromise=gifCache.get(this.file);if(cachedGifPromise)return cachedGifPromise;var gifPromise=Promises.xhrGet(this.file,"*/*","arraybuffer").then(function(buffer){return _this.explode(buffer)});return gifCache.set(this.file,gifPromise),gifPromise},Exploder.prototype.explode=function(buffer){return console.debug("EXPLODING "+this.file),new Promise(function(resolve,reject){var frames=[],streamReader=new StreamReader(buffer);if("GIF89a"!=streamReader.readAscii(6))return void reject(Error("Not a GIF!"));if(streamReader.skipBytes(4),streamReader.peekBit(1)){streamReader.log("GLOBAL COLOR TABLE");var colorTableSize=7&streamReader.readByte();streamReader.log("GLOBAL COLOR TABLE IS "+3*Math.pow(2,colorTableSize+1)+" BYTES"),streamReader.skipBytes(2),streamReader.skipBytes(3*Math.pow(2,colorTableSize+1))}else streamReader.log("NO GLOBAL COLOR TABLE");for(var gifHeader=buffer.slice(0,streamReader.index),spinning=!0,expectingImage=!1;spinning;)if(streamReader.isNext([33,255])){streamReader.log("APPLICATION EXTENSION"),streamReader.skipBytes(2);var blockSize=streamReader.readByte();if(streamReader.log(streamReader.readAscii(blockSize)),streamReader.isNext([3,1]))streamReader.skipBytes(5);else{for(streamReader.log("A weird application extension. Skip until we have 2 NULL bytes");0!==streamReader.readByte()||0!==streamReader.peekByte(););streamReader.log("OK moving on"),streamReader.skipBytes(1)}}else if(streamReader.isNext([33,254])){for(streamReader.log("COMMENT EXTENSION"),streamReader.skipBytes(2);!streamReader.isNext([0]);){var blockSize=streamReader.readByte();streamReader.log(streamReader.readAscii(blockSize))}streamReader.skipBytes(1)}else if(streamReader.isNext([44])){if(streamReader.log("IMAGE DESCRIPTOR!"),expectingImage||frames.push({index:streamReader.index,delay:0}),expectingImage=!1,streamReader.skipBytes(9),streamReader.peekBit(1)){streamReader.log("LOCAL COLOR TABLE");var colorTableSize=7&streamReader.readByte();streamReader.log("LOCAL COLOR TABLE IS "+3*Math.pow(2,colorTableSize+1)+" BYTES"),streamReader.skipBytes(3*Math.pow(2,colorTableSize+1))}else streamReader.log("NO LOCAL TABLE PHEW"),streamReader.skipBytes(1);for(streamReader.log("MIN CODE SIZE "+streamReader.readByte()),streamReader.log("DATA START");!streamReader.isNext([0]);){var blockSize=streamReader.readByte();streamReader.skipBytes(blockSize)}streamReader.log("DATA END"),streamReader.skipBytes(1)}else if(streamReader.isNext([33,249,4])){streamReader.log("GRAPHICS CONTROL EXTENSION!");var index=streamReader.index;streamReader.skipBytes(3);var disposalMethod=streamReader.readByte()>>2;streamReader.log("DISPOSAL "+disposalMethod);var delay=streamReader.readByte()+256*streamReader.readByte();frames.push({index:index,delay:delay,disposal:disposalMethod}),streamReader.log("FRAME DELAY "+delay),streamReader.skipBytes(2),expectingImage=!0}else{for(var maybeTheEnd=streamReader.index;!streamReader.finished()&&!streamReader.isNext([33,249,4]);)streamReader.readByte();streamReader.finished()?(streamReader.index=maybeTheEnd,streamReader.log("WE END"),spinning=!1):streamReader.log("UNKNOWN DATA FROM "+maybeTheEnd)}for(var endOfFrames=streamReader.index,gifFooter=buffer.slice(-1),i=0;i<frames.length;i++){var frame=frames[i],nextIndex=i<frames.length-1?frames[i+1].index:endOfFrames;frame.blob=new Blob([gifHeader,buffer.slice(frame.index,nextIndex),gifFooter],{type:"image/gif"}),frame.url=url.createObjectURL(frame.blob)}resolve(new Gif(frames))})},module.exports=Exploder},function(module){"use strict";var defaultFrameDelay=10,Gif=function(frames){var _this=this;this.frames=frames,this.length=0,this.offsets=[],frames.forEach(function(frame){_this.offsets.push(_this.length),_this.length+=frame.delay||defaultFrameDelay})};Gif.prototype.frameAt=function(fraction){for(var offset=fraction*this.length,i=1,l=this.offsets.length;l>i&&!(this.offsets[i]>offset);i++);return i-1},module.exports=Gif},function(module){"use strict";var StreamReader=function(arrayBuffer){this.data=new Uint8Array(arrayBuffer),this.index=0,this.log("TOTAL LENGTH: "+this.data.length)};StreamReader.prototype.finished=function(){return this.index>=this.data.length},StreamReader.prototype.readByte=function(){return this.data[this.index++]},StreamReader.prototype.peekByte=function(){return this.data[this.index]},StreamReader.prototype.skipBytes=function(n){this.index+=n},StreamReader.prototype.peekBit=function(i){return!!(this.peekByte()&1<<8-i)},StreamReader.prototype.readAscii=function(n){for(var s="",i=0;n>i;i++)s+=String.fromCharCode(this.readByte());return s},StreamReader.prototype.isNext=function(array){for(var i=0;i<array.length;i++)if(array[i]!==this.data[this.index+i])return!1;return!0},StreamReader.prototype.log=function(){},StreamReader.prototype.error=function(str){console.error(this.index+": "+str)},module.exports=StreamReader},function(module,exports){"use strict";exports.Promises={xhrGet:function(url,accept,responseType){return new Promise(function(resolve,reject){var loader=new XMLHttpRequest;loader.open("GET",url,!0),loader.setRequestHeader("Accept",accept),loader.responseType=responseType,loader.onload=function(){200==this.status?resolve(this.response):reject(Error(this.statusText))},loader.onerror=function(){reject(Error("Network Error"))},loader.send()})}}}])});
//# sourceMappingURL=exploder.min.map